<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cloudastick Real Estate Experience</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet" />
    <style>
      body {
        margin: 0;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        background-color: #000;
        color: #fff;
        overflow-x: hidden;
      }
      canvas {
        display: block;
      }
      .header-overlay {
        position: absolute;
        top: 0;
        width: 100%;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10;
      }
      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: #fff;
      }
      .btn-gold {
        background-color: #f6d984;
        color: #000;
        font-weight: bold;
        border-radius: 6px;
        border: none;
      }
      .btn-gold:hover {
        background-color: #fff;
      }
      #testimonial-section iframe {
        border-radius: 8px;
        box-shadow: 0 0 12px #f6d984;
      }
      @media (max-width: 576px) {
        #testimonial-section iframe {
          width: 100% !important;
          height: auto !important;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.min.js"></script>
  </head>
  <body>
    <canvas id="three-canvas"></canvas>
    <div class="header-overlay container-fluid animate__animated animate__fadeInDown">
      <div class="row align-items-center">
        <div class="col-6 logo">CLOUDASTICK<span style="color: #f6d984;">.</span></div>
        <div class="col-6 text-end">
          <button class="btn btn-gold me-2" onclick="scrollToForm()">Explore</button>
          <button class="btn btn-gold" onclick="scrollToForm()">Book a Demo</button>
        </div>
      </div>
    </div>
    <section id="testimonial-section" class="position-absolute bottom-0 start-0 p-3 z-3 animate__animated animate__fadeInUp">
      <div class="ratio ratio-16x9" style="max-width: 360px;">
        <iframe src="https://www.youtube.com/embed/-fy8DO56Oxs?autoplay=1&mute=1&playsinline=1" title="Testimonial Video" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
    </section>
    <section class="container mt-5 text-center animate__animated animate__fadeInUp">
      <h2 class="text-white mb-4">Recommended Properties</h2>
      <div id="properties-container" class="row justify-content-center g-4"></div>
    </section>
    <script>
      async function fetchPropertiesFromSalesforce() {
        try {
          const response = await fetch("/api/properties.js?page=1&pageSize=10&min_price=100000&city=New Cairo&tag=contemporary");
          const data = await response.json();
          const container = document.getElementById("properties-container");
          container.innerHTML = "";
          data.forEach((prop) => {
            const col = document.createElement("div");
            col.className = "col-md-4 col-sm-6 animate__animated animate__fadeInUp";
            col.innerHTML = `
              <div class="card bg-dark text-white border-light h-100">
                <img src="${prop.Picture__c}" class="card-img-top" alt="Property Image" />
                <div class="card-body">
                  <h5 class="card-title">${prop.Name}</h5>
                  <p class="card-text">Price: ${prop.Price__c}<br>Rooms: ${prop.Beds__c}</p>
                  <a href="${prop.Record_Link__c}" target="_blank" class="btn btn-gold mt-2">View on Salesforce</a>
                </div>
              </div>
            `;
            container.appendChild(col);
          });
        } catch (err) {
          console.error("Failed to fetch properties", err);
  showErrorToast("Salesforce Error: " + (err.message || JSON.stringify(err)));
        }
      }

      fetchPropertiesFromSalesforce();

      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);
      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 30, 50);
      const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(20, 50, 10);
      scene.add(directionalLight);

      for (let i = 0; i < 20; i++) {
        const geometry = new THREE.BoxGeometry(4, Math.random() * 15 + 5, 4);
        const material = new THREE.MeshStandardMaterial({ color: 0xf6d984 });
        const building = new THREE.Mesh(geometry, material);
        building.position.x = (Math.random() - 0.5) * 80;
        building.position.z = (Math.random() - 0.5) * 80;
        building.position.y = geometry.parameters.height / 2;
        scene.add(building);
      }

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }

      animate();

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      window.scrollToForm = () => {
        alert('Smooth scroll to lead form will go here.');
      };
    </script>
  
<!-- Error Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
  <div id="errorToast" class="toast align-items-center text-white bg-danger border-0 animate__animated animate__fadeInUp" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">
        <!-- Error message will appear here -->
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function showErrorToast(message) {
    document.getElementById('toastMessage').innerText = message;
    const toastEl = document.getElementById('errorToast');
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  }
</script>

</body>
</html>